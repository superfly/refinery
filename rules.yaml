RulesVersion: 2
Samplers:
  __default__:
    DeterministicSampler:
      SampleRate: 1
  prod:
    RulesBasedSampler:
      Rules:
        - Name: Corrosion Slow Apply
          Conditions:
            - Field: fsm.type
              Operator: =
              Value: corrosion
            - Field: fsm.action
              Operator: =
              Value: apply
            - Field: service.name
              Operator: =
              Value: flyd
            - Field: duration_ms
              Operator: '>='
              Value: 5000
              Datatype: float
          Drop: false
          SampleRate: 1
        - Name: Sample Corrosion Apply
          Conditions:
            - Field: fsm.type
              Operator: =
              Value: corrosion
            - Field: fsm.action
              Operator: =
              Value: apply
            - Field: status_code
              Operator: =
              Value: 0
            - Field: service.name
              Operator: =
              Value: flyd
          Drop: false
          SampleRate: 100
        - Name: keep fsm actions
          Conditions:
            - Field: fsm.action
              Operator: exists
          Drop: false
          SampleRate: 1
        - Name: sample tkdb revocation heartbeats
          Conditions:
            - Field: name
              Operator: =
              Value: Revocation
            - Field: library.name
              Operator: =
              Value: tkdb-client
            - Field: service.name
              Operator: =
              Value: flaps
          Drop: false
          SampleRate: 100
        - Name: Corrosion Ops dynamic sampler
          Conditions:
            - Field: http.url
              Operator: =
              Value: "http://[fc01::1]:7878/v1/ops"
              Datatype: string
            - Field: http.status_code
              Operator: exists
          Sampler:
            EMADynamicSampler:
              GoalSampleRate: 25
              AdjustmentInterval: "15s"
              Weight: 0.5
              AgeOutValue: 0.5
              BurstMultiple: 2
              BurstDetectionDelay: 1
              MaxKeys: 500
              UseTraceLength: false
              FieldList:
                - http.url
                - http.status_code
        - Name: RPC dynamic sampler
          Conditions:
            - Field: rpc.service
              Operator: exists
            - Field: rpc.method
              Operator: exists
            - Field: cloud.region
              Operator: exists
            - Field: status_code
              Operator: exists
          Sampler:
            EMADynamicSampler:
              GoalSampleRate: 25
              AdjustmentInterval: "15s"
              Weight: 0.5
              AgeOutValue: 0.5
              BurstMultiple: 2
              BurstDetectionDelay: 1
              MaxKeys: 500
              UseTraceLength: false
              FieldList:
                - cloud.region
                - rpc.service
                - rpc.method
                - status_code

        - Name: machine.preparing_image slow keep all
          Conditions:
            - Field: name
              Operator: =
              Value: machine.preparing_image
            - Field: duration_ms
              Operator: '>='
              Value: 5_000
              Datatype: float
          Drop: false
          SampleRate: 1

        - Name: fsm.error exists keep all
          Conditions:
            - Field: fsm.error_kind
              Operator: exists
          Drop: false
          SampleRate: 1

        - Name: default
          SampleRate: 70
